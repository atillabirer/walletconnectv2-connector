{"version":3,"file":"walletconnectv2-connector.cjs.development.js","sources":["../src/index.tsx"],"sourcesContent":["import { AbstractConnector } from \"@web3-react/abstract-connector\";\nimport { ConnectorUpdate } from '@web3-react/types'\nimport UniversalProvider from \"@walletconnect/universal-provider\"\nimport SignClient from \"@walletconnect/sign-client\";\nimport {providers} from \"ethers\";\nimport { Web3Modal } from \"@web3modal/standalone\";\nimport {SessionTypes} from \"@walletconnect/types\"\n\n\nconst projectId = \"ad2993f3d628ec73d7307035cb36c4f0\";\n\n\nexport class WalletConnectConnector extends AbstractConnector {\n  public provider?: UniversalProvider;\n  public web3Provider?: providers.Web3Provider;\n  public signClient?: SignClient;\n  constructor() {\n    super({supportedChainIds: [1284]})\n  }\n  public async activate() : Promise<ConnectorUpdate> {\n\n\n    const web3Modal = new Web3Modal({\n      projectId: projectId,\n      defaultChain: [1284],\n      \n      walletConnectVersion: 2,\n      desktopWallets: [\n        {\n          id: \"metamask\",\n          name: \"MetaMask\",\n          links: {\n            native: \"metamask://\",\n            universal: \"\"\n          }\n        }\n      ]\n    \n    });\n    \n\n    \n\n\n    const provider = await UniversalProvider.init({\n      projectId: \"ad2993f3d628ec73d7307035cb36c4f0\",\n      relayUrl: \"wss://relay.walletconnect.com\",\n      \n      \n      \n    })\n    \n\n    provider.on(\"display_uri\", async (uri: string) => {\n      console.log(\"EVENT\", \"QR Code Modal open\");\n      web3Modal?.openModal({ uri });\n    });\n\n    // Subscribe to session ping\n    provider.on(\"session_ping\", ({ id, topic }: { id: number; topic: string }) => {\n      console.log(\"EVENT\", \"session_ping\");\n      console.log(id, topic);\n    });\n\n    // Subscribe to session event\n    provider.on(\"session_event\", ({ event, chainId }: { event: any; chainId: string }) => {\n      console.log(\"EVENT\", \"session_event\");\n      console.log(event, chainId);\n    });\n\n    // Subscribe to session update\n    provider.on(\n      \"session_update\",\n      ({ topic, session }: { topic: string; session: SessionTypes.Struct }) => {\n        console.log(\"EVENT\", \"session_updated\");\n        console.log(topic,session);\n        //setSession(session);\n      },\n    );\n\n    // Subscribe to session delete\n    provider.on(\"session_delete\", ({ id, topic }: { id: number; topic: string }) => {\n      console.log(\"EVENT\", \"session_deleted\");\n      console.log(id, topic);\n     \n    });\n\n    this.provider = provider;\n    \n\n    this.signClient = provider.client;\n\n    \n    \n    \n      await provider.connect({\n        \n\n      namespaces: {\n        eip155: {\n          methods: [\n            \"eth_sendTransaction\",\n            \"eth_signTransaction\",\n            \"eth_sign\",\n            \"personal_sign\",\n            \"eth_signTypedData\",\n          ],\n          chains: [`eip155:1284`],\n          events: [\"chainChanged\", \"accountsChanged\"],\n          rpcMap: {\n            1284: \"https://rpc.api.moonbeam.network\"\n          }\n        },\n      },\n      \n    })\n    \n    this.web3Provider = new providers.Web3Provider(provider);\n    \n    \n    const result = await provider.enable();\n    return {provider: provider,account:result[0]}\n\n  }\n\n  public async getProvider(): Promise<any> {\n    return this.web3Provider;\n  }\n\n  \n\n  public async getChainId(): Promise<number> {\n    return 1284;\n  }\n\n  public async getAccount(): Promise<null | string> {\n    const accs = await this.web3Provider?.listAccounts();\n    return accs![0];\n  }\n\n\n  public async deactivate() {\n    console.log(\"deactivate called\")\n    this.provider?.disconnect();\n\n\n  }\n  public async close() {\n    this.emitDeactivate();\n  }\n}"],"names":["projectId","WalletConnectConnector","_AbstractConnector","_inheritsLoose","call","supportedChainIds","_proto","prototype","activate","_activate","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","web3Modal","provider","result","wrap","_callee2$","_context2","prev","next","Web3Modal","defaultChain","walletConnectVersion","desktopWallets","id","name","links","universal","UniversalProvider","init","relayUrl","sent","on","_ref","_callee","uri","_callee$","_context","console","log","openModal","stop","_x","apply","arguments","_ref2","topic","_ref3","event","chainId","_ref4","session","_ref5","signClient","client","connect","namespaces","eip155","methods","chains","events","rpcMap","web3Provider","providers","Web3Provider","enable","abrupt","account","getProvider","_getProvider","_callee3","_callee3$","_context3","getChainId","_getChainId","_callee4","_callee4$","_context4","getAccount","_getAccount","_callee5","_this$web3Provider","accs","_callee5$","_context5","listAccounts","deactivate","_deactivate","_callee6","_this$provider","_callee6$","_context6","disconnect","close","_close","_callee7","_callee7$","_context7","emitDeactivate","AbstractConnector"],"mappings":"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"}