{"version":3,"file":"walletconnectv2-connector.cjs.production.min.js","sources":["../src/index.tsx"],"sourcesContent":["import { AbstractConnector } from \"@web3-react/abstract-connector\";\nimport { ConnectorUpdate } from '@web3-react/types'\nimport UniversalProvider from \"@walletconnect/universal-provider\"\nimport SignClient from \"@walletconnect/sign-client\";\nimport {providers} from \"ethers\";\nimport { Web3Modal } from \"@web3modal/standalone\";\nimport {SessionTypes} from \"@walletconnect/types\"\n\n\nconst projectId = \"ad2993f3d628ec73d7307035cb36c4f0\";\n\n\nexport class WalletConnectConnector extends AbstractConnector {\n  public provider?: UniversalProvider;\n  public web3Provider?: providers.Web3Provider;\n  public signClient?: SignClient;\n  constructor() {\n    super({supportedChainIds: [1284]})\n  }\n  public async activate() : Promise<ConnectorUpdate> {\n\n\n    const web3Modal = new Web3Modal({\n      projectId: projectId,\n      defaultChain: [1284],\n      \n      walletConnectVersion: 2,\n      desktopWallets: [\n        {\n          id: \"metamask\",\n          name: \"MetaMask\",\n          links: {\n            native: \"metamask://\",\n            universal: \"\"\n          }\n        }\n      ]\n    \n    });\n    \n\n    \n\n\n    const provider = await UniversalProvider.init({\n      projectId: \"ad2993f3d628ec73d7307035cb36c4f0\",\n      relayUrl: \"wss://relay.walletconnect.com\",\n      \n      \n      \n    })\n    \n\n    provider.on(\"display_uri\", async (uri: string) => {\n      console.log(\"EVENT\", \"QR Code Modal open\");\n      web3Modal?.openModal({ uri });\n    });\n\n    // Subscribe to session ping\n    provider.on(\"session_ping\", ({ id, topic }: { id: number; topic: string }) => {\n      console.log(\"EVENT\", \"session_ping\");\n      console.log(id, topic);\n    });\n\n    // Subscribe to session event\n    provider.on(\"session_event\", ({ event, chainId }: { event: any; chainId: string }) => {\n      console.log(\"EVENT\", \"session_event\");\n      console.log(event, chainId);\n    });\n\n    // Subscribe to session update\n    provider.on(\n      \"session_update\",\n      ({ topic, session }: { topic: string; session: SessionTypes.Struct }) => {\n        console.log(\"EVENT\", \"session_updated\");\n        console.log(topic,session);\n        //setSession(session);\n      },\n    );\n\n    // Subscribe to session delete\n    provider.on(\"session_delete\", ({ id, topic }: { id: number; topic: string }) => {\n      console.log(\"EVENT\", \"session_deleted\");\n      console.log(id, topic);\n     \n    });\n\n    this.provider = provider;\n    \n\n    this.signClient = provider.client;\n\n    \n    \n    \n      await provider.connect({\n        \n\n      namespaces: {\n        eip155: {\n          methods: [\n            \"eth_sendTransaction\",\n            \"eth_signTransaction\",\n            \"eth_sign\",\n            \"personal_sign\",\n            \"eth_signTypedData\",\n          ],\n          chains: [`eip155:1284`],\n          events: [\"chainChanged\", \"accountsChanged\"],\n          rpcMap: {\n            1284: \"https://rpc.api.moonbeam.network\"\n          }\n        },\n      },\n      \n    })\n    \n    this.web3Provider = new providers.Web3Provider(provider);\n    \n    \n    const result = await provider.enable();\n    return {provider: provider,account:result[0]}\n\n  }\n\n  public async getProvider(): Promise<any> {\n    return this.web3Provider;\n  }\n\n  \n\n  public async getChainId(): Promise<number> {\n    return 1284;\n  }\n\n  public async getAccount(): Promise<null | string> {\n    const accs = await this.web3Provider?.listAccounts();\n    return accs![0];\n  }\n\n\n  public async deactivate() {\n    console.log(\"deactivate called\")\n    this.provider?.disconnect();\n\n\n  }\n  public async close() {\n    this.emitDeactivate();\n  }\n}"],"names":["_AbstractConnector","WalletConnectConnector","call","supportedChainIds","_proto","prototype","activate","_activate","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","web3Modal","provider","wrap","_context2","prev","next","Web3Modal","projectId","defaultChain","walletConnectVersion","desktopWallets","id","name","links","native","universal","UniversalProvider","init","relayUrl","sent","on","_ref","_callee","uri","_context","console","log","openModal","stop","_x","apply","arguments","_ref2","topic","_ref3","event","chainId","_ref4","session","_ref5","this","signClient","client","connect","namespaces","eip155","methods","chains","events","rpcMap","1284","web3Provider","providers","Web3Provider","enable","abrupt","account","getProvider","_getProvider","_callee3","_context3","getChainId","_getChainId","_callee4","_context4","getAccount","_getAccount","_callee5","_this$web3Provider","_context5","listAccounts","deactivate","_deactivate","_callee6","_this$provider","_context6","disconnect","close","_close","_callee7","_context7","emitDeactivate","AbstractConnector"],"mappings":"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"}